<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap.css">
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/popups.js"></script>
    <style>
        *{margin:0;padding: 0}
        .col-12{
            background: #222;
            overflow: hidden;
            user-select: none;
            height: 1000px;
        }
        .perspective{
            perspective: 800px;
            padding-left: 50px
        }
        .wrap{
            transform-style: preserve-3d;
            width: 120px;
            height: 230px;
            margin: 100px auto;
            position: relative;
            transform: rotateX(-10deg) rotateY(0deg);
        }
        #myImg{
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;;
            transform: rotateY(0deg) rotateZ(0px);
            padding: 10px;
            background: transparent;
            box-shadow: 0 0 4px #fff;
            border-radius: 5px;
            -webkit-box-reflect: below 5px -webkit-linear-gradient(top,rgba(0,0,0,0) 40%,rgba(0,0,0,.5)100%) 
        }
        .wrap p{
        width:1200px;
        height:1200px;
        background:-webkit-radial-gradient(center center ,600px 600px, rgba(122,122,122,0.5),rgba(0,0,0,0));
        position:absolute;
        border-radius:50%;
        left:50%;
        top:100%;
        margin-left:-600px;
        margin-top:-600px;
        transform:rotateX(90deg); /*沿着x轴方向摁倒*/
    }
    </style>
</head>
<body>
    <div>
        <div class="row">
            <div class="col-12">
                <div class="perspective">
                    <div class="wrap">
                            <div id="outerdiv">
                                <div>
                                    <img  class="<%=prize_info[i].id%>" id="myImg" src='<%=prize_info[i].imgUrl%>' style="width: 133px;height: 200px;margin: 20px;" alt='#' title="<%=prize_info[i].prize_name%>" data="<%=prize_info[i].id%>" prize_name = "<%=prize_info[i].prize_name%>" prize_draw = "<%=prize_info[i].signIn_id%>">
                                </div>
                            </div>
                    <p></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    window.onload=function(){
        var name = window.location.search
        var theRequest = new Object()
        if(name.indexOf("?")!= -1){
            var str = name.substr(1);
            strs = str.split("&");  
            for(var i = 0; i < strs.length; i ++) {  
                theRequest[strs[i].split("=")[0]]=decodeURIComponent(strs[i].split("=")[1]);  
            }
            var round = theRequest.round 
            window.localStorage.setItem('round',round) 
        }
/*最新的原生获取元素方法querySelectorAll*/
    //console.log(document.getElementByTagName("img").style.border)
    var myImgNumber = document.getElementById('outerdiv')
    var oImg=document.querySelectorAll('#myImg'); 
    var oWrap=document.querySelector('.wrap');
    var lastX,lastY,nowX,nowY,minusX,minusY,roY=0,roX=-10;
    var timer=null;
    var length=oImg.length;  
    var Deg=360/length;      
    for(var i=0;i<length;i++){
        oImg[i].style.transform='rotateY('+ i*Deg +'deg) translateZ(350px)';
        oImg[i].style.transition='transform 1s '+(length-1-i)*0.2+'s'
    }
    mTop();
    window.onresize=mTop;
    function mTop(){
            /*获取浏览器窗口可视高度*/
        var wH=document.documentElement.clientHeight||document.body.clientHeight;
        oWrap.style.marginTop=(wH/2)-oWrap.offsetHeight+'px';
    }
    /*拖拽drag 按下 onmousedown 移动 onmousemove 抬起 onmouseup */
    document.onmousedown=function(event){ 
        event=event||window.event;			
        lastX=event.clientX;				
        lastY=event.clientY;				
        clearInterval(timer);
        document.onmousemove=function(event){
            event=event||window.event;	
            nowX=event.clientX;           
            nowY=event.clientY;				
            minusX=nowX-lastX;           
            minusY=nowY-lastY;				
            roY+=minusX*0.2;				
            roX-=minusY*0.1;				
            oWrap.style.transform='rotateX('+roX+'deg) rotateY('+roY+'deg)' 
            lastX=nowX;						
            lastY=nowY;					
        }
        document.onmouseup=function(){
            document.onmousemove=null;
            timer=setInterval(function(){
            
                minusX*=0.9;                     
                minusY*=0.9;
                roY+=minusX*0.2;				
                roX-=minusY*0.1;				
                oWrap.style.transform='rotateX('+roX+'deg) rotateY('+roY+'deg)';
                if(Math.abs(minusX)<0.1&&Math.abs(minusY)<0.1){	
                    clearInterval(timer);    
                }
            },13);
        }
        return false;
    }
    if(myImgNumber == null){
        var COLOR = "#52E6FF" 
        var MESSAGE = document.getElementById("title-desktop").textContent;
        var FONT_SIZE = 100;
        var AMOUNT = 2000;
        var SIZE = 2;
        var INITIAL_DISPLACEMENT = 500;
        var INITIAL_VELOCITY = 5;
        var VELOCITY_RETENTION = 0.95;
        var SETTLE_SPEED = 1;
        var FLEE_SPEED = 1;
        var FLEE_DISTANCE = 50;
        var FLEE = true;
        var SCATTER_VELOCITY = 3;
        var SCATTER = true;

        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
        // Mobile
        MESSAGE = document.getElementById("title-mobile").textContent;
        
        FONT_SIZE = 50;
        AMOUNT = 300;
        SIZE = 2;
        INITIAL_DISPLACEMENT = 100;
        SETTLE_SPEED = 1;
        FLEE = false;
        SCATTER_VELOCITY = 2;
        }

        const canvas = document.getElementById("spring-text");
        const ctx = canvas.getContext("2d");

        var POINTS = [];
        var MOUSE = {
        x: 0,
        y: 0
        }

        function Point(x,y,r,g,b,a) {
        var angle = Math.random() * 6.28;
        this.dest_x = x;
        this.dest_y = y;
        this.original_r = r;
        this.original_g = g;
        this.original_a = a;
        this.x = canvas.width/2 - x + (Math.random() - 0.5) * INITIAL_DISPLACEMENT;
        this.y = canvas.height/2 - y + (Math.random() - 0.5) * INITIAL_DISPLACEMENT;
        this.velx = INITIAL_VELOCITY * Math.cos(angle);
        this.vely = INITIAL_VELOCITY * Math.sin(angle);
        this.target_x = canvas.width/2 - x;
        this.target_y = canvas.height/2 - y;
        this.r = r;
        this.g = g;
        this.b = b;
        this.a = a;
        
        this.getX = function() {
            return this.x;
        }
        
        this.getY = function() {
            return this.y;
        }
        
        this.resetTarget = function () {
            this.target_x = canvas.width/2 - this.dest_x;
            this.target_y = canvas.height/2 - this.dest_y;
        }
        
        this.fleeFrom = function(x, y) {
            this.velx -= ((MOUSE.x - this.x) * FLEE_SPEED / 10);
            this.vely -= ((MOUSE.y - this.y) * FLEE_SPEED / 10);
        }
        
        this.settleTo = function(x, y) {
            this.velx += ((this.target_x - this.x) * SETTLE_SPEED / 100);
            this.vely += ((this.target_y - this.y) * SETTLE_SPEED / 100);
            this.velx -= this.velx * (1-VELOCITY_RETENTION);
            this.vely -= this.vely * (1-VELOCITY_RETENTION);
        }
        
        this.scatter = function() {
            var unit = this.unitVecToMouse();
            var vel = SCATTER_VELOCITY * 10 * (0.5 + Math.random() / 2);
            this.velx = -unit.x * vel;
            this.vely = -unit.y * vel;
        }
        
        this.move = function() {
            if (this.distanceToMouse() <= FLEE_DISTANCE) {
            this.fleeFrom(MOUSE.x, MOUSE.y);
            }
            else {
            this.settleTo(this.target_x, this.target_y);
            }
            
            if (this.x + this.velx < 0 || this.x + this.velx >= canvas.width) {
            this.velx *= -1;
            }
            if (this.y + this.vely < 0 || this.y + this.vely >= canvas.height) {
            this.vely *= -1;
            }
            
            this.x += this.velx;
            this.y += this.vely;
        }
        
        this.distanceToTarget = function() {
            return this.distanceTo(this.target_x, this.target_y);
        }
        
        this.distanceToMouse = function() {
            return this.distanceTo(MOUSE.x, MOUSE.y);
        }
        
        this.distanceTo = function(x, y) {
            return Math.sqrt((x - this.x)*(x - this.x) + (y - this.y)*(y - this.y));
        }
        
        this.unitVecToTarget = function() {
            return this.unitVecTo(this.target_x, this.target_y);
        }
        
        this.unitVecToMouse = function() {
            return this.unitVecTo(MOUSE.x, MOUSE.y);
        }
        
        this.unitVecTo = function(x, y) {
            var dx = x - this.x;
            var dy = y - this.y;
            return {
            x: dx / Math.sqrt(dx*dx + dy*dy),
            y: dy / Math.sqrt(dx*dx + dy*dy)
            };
        }
        }

        window.addEventListener("resize", function() {
        resizeCanvas()
        adjustText()
        });

        if (FLEE) {
        window.addEventListener("mousemove", function(event) {
            MOUSE.x = event.clientX;
            MOUSE.y = event.clientY;
        });
        }

        if (SCATTER) {
        window.addEventListener("click", function(event) {
            MOUSE.x = event.clientX;
            MOUSE.y = event.clientY;
            for (var i=0; i<POINTS.length; i++) {
            POINTS[i].scatter();
            }
        });
        }

        function resizeCanvas() {
        canvas.width  = window.innerWidth;
        canvas.height = window.innerHeight;
        }

        function adjustText() {
        ctx.fillStyle = COLOR;
        ctx.textBaseline = "middle";
        ctx.textAlign = "center";
        ctx.font = FONT_SIZE + "px Arial";
        ctx.fillText(MESSAGE, canvas.width/2, canvas.height/2);
        var textWidth = ctx.measureText(MESSAGE).width;
        if (textWidth == 0) {
            return;
        }
        var minX = canvas.width/2 - textWidth/2;
        var minY = canvas.height/2 - FONT_SIZE/2;
        var data = ctx.getImageData(minX, minY, textWidth, FONT_SIZE).data;
        var isBlank = true;
        for (var i=0; i<data.length; i++) {
            if (data[i] != 0) {
            isBlank = false;
            break;
            }
        }
        if (!isBlank) {
            var count = 0;
            var curr = 0;
            var num = 0;
            var x = 0;
            var y = 0;
            var w = Math.floor(textWidth);
            POINTS = [];
            while (count < AMOUNT) {
            while (curr == 0) {
                num = Math.floor(Math.random() * data.length);
                curr = data[num];
            }
            num = Math.floor(num / 4);
            x = w/2 - num%w;
            y = FONT_SIZE/2 - Math.floor(num/w);
            POINTS.push(new Point(x,y,data[num*4],data[num*4 + 1],data[num*4 + 2],data[num*4 + 3]));
            curr = 0;
            count++;
            }
        }
        }

        function init() {
        resizeCanvas()
        adjustText()
        window.requestAnimationFrame(animate);
        }

        function animate() {
        update();
        draw();
        }

        function update() {
        var point;
        for (var i=0; i<POINTS.length; i++) {
            point = POINTS[i];
            point.move();
        }
        }

        function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        var point;
        for (var i=0; i<POINTS.length; i++) {
            point = POINTS[i];
            ctx.fillStyle = "rgba("+point.r+","+point.g+","+point.b+","+point.a+")";
            ctx.beginPath();
            ctx.arc(point.getX(),point.getY(),SIZE,0,2*Math.PI);
            ctx.fill();
        }
        window.requestAnimationFrame(animate);
        }
        init();
            //倒计时挑转
            function FunSecond(){
            function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串   
            var theRequest = new Object();   
            if (url.indexOf("?") != -1) {   
                var str = url.substr(1);   
                strs = str.split("&");   
                for(var i = 0; i < strs.length; i ++) {   
                    theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);   
                }   
            }   
                return theRequest;   
            }
            var Request = new Object();
            Request = GetRequest();
            var round = Request['round'];
            window.location.href = './draw/winner?round='+round
        }
        $(window).keydown(function(e){
            switch(e.keyCode){
                case 32 : FunSecond()
            }
        })
    }

    var round_info = window.location.search
    var index = round_info.substr(-1)
    if(index == 1){
        
    }
    // $("body").append("<div class = 'round_info'><div class = 'roundNum'>"+roundNum+"</div>"+
    // "<div class = 'round_rule'><span></span><span></span></div>"+
    // "</div>")
}
    </script>
    <script>
        $("img").dblclick(function(){
            var _this = $(this);
            var prize_id = _this.attr('data');
            //console.log(prize_id)
            window.location.href = '/home/draw_single?prize_id='+prize_id
        })
    </script>
</html>